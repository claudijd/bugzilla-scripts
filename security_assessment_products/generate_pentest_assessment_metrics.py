#!/usr/bin/env python
import bugsy
import getpass
import json

api_key = getpass.getpass("Enter Bugzilla API Key: ")

bugzilla = bugsy.Bugsy(api_key=api_key)
bugs = bugzilla.search_for\
        .product('Enterprise Information Security')\
        .component('Penetration Test')\
        .search()

bug_metrics = []

for bug in bugs:
	if bug.status == "RESOLVED" and bug.resolution == "FIXED":
		raw_whiteboard = bug._bug['whiteboard']
		whiteboard = dict(x.split('=') for x in raw_whiteboard.split(' '))
		bug_metrics.append({'id':bug.id, 'summary':bug.summary, 'whiteboard':whiteboard})

# Send this somewhere for further analytics/graphs/rainbows/etc.
print(json.JSONEncoder().encode(bug_metrics))